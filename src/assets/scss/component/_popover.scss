/**
 * popover
 * 主にツールチップ用（吹き出し + アニメーション）
 */

@use '../foundation'as *;
@use '../global' as g;

/* popover 機能を使う要素の初期設定 */
[popover] {
	border: none;
	background: transparent;
	overflow: visible;
	padding: 0;
	transition:
		display .25s allow-discrete,
		overlay .25s allow-discrete;
}


/* ---------------------------------------------------------
popover 本体（吹き出しボックス）
<div class="c-popbox" popover id="...">
--------------------------------------------------------- */
.c-popbox {
	position: relative;
	//position: absolute;
	position-area: top span-right;
	margin: 0.85em .5em;
	max-width: -webkit-fill-available;
	width: max-content;

	background-color: rgba(20, 20, 30, 0.6);
	backdrop-filter: blur(12px);
	border: 1px solid rgba(255, 255, 255, 0.1);
	border-radius: $border-radius-sm;
	box-shadow:
		0 4px 6px -1px rgba(0, 0, 0, 0.2),
		0 2px 4px -1px rgba(0, 0, 0, 0.06),
		0 0 0 1px rgba(255, 255, 255, 0.05) inset;

	color: $color-white;
	padding: $spacing-2;
	font-size: .9em;
	line-height: $line-height-relaxed;

	opacity: 0;
	transform: translateY(0) scale(0.8);

	@include mq(md) {
		max-width: rem(320);
	}

	a{
		color: $color-white;
		text-decoration: underline;
		text-decoration-color: $color-white;
		&:hover{
			filter: brightness(0) saturate(100%) invert(14%) sepia(90%) saturate(7455%) hue-rotate(329deg) brightness(101%) contrast(102%);
		}
	}

	ul{
		margin-top: $spacing-1;

		li{
			margin-left: 1em;
			text-indent: -1em;

			&::before{
				content: '';
				width: .3em;
				height: .3em;
				background-color: var(--color-primary);
				border-radius: $border-radius-full;
				display: inline-block;
				margin-right: .5em;
				vertical-align: middle;
			}
		}
	}

	/* 表示時のアニメーション */
	&:popover-open {
		opacity: 1;
		transform: translateY(0) scale(1);
		animation: popover-fade-in .2s ease;
		transition:
			display .2s allow-discrete;
	}

	/* 閉じる時はアニメーションなし（即座に非表示） */
	&:not(:popover-open) {
		opacity: 0;
		transform: translateY(0) scale(0.8);
		transition: none;
	}


	/* アニメーション定義（開く時のみ） */
	@keyframes popover-fade-in {
		from {
			opacity: 0;
			transform: translateY(0) scale(0.8);
		}
		to {
			opacity: 1;
			transform: translateY(0) scale(1);
		}
	}

	&::before {
		content: "";
		position: absolute;
		display: block;
		width: 1.25em;
		height: .6em;
		left: 1em;
		bottom: -9px;

		clip-path: polygon(0 0, 100% 0%, 50% 100%);
		background-color: rgba(20, 20, 30, 0.6);
		z-index: 2;
	}


}



/* ---------------------------------------------------------
popover トリガーとなるバッジ（?マーク付きボタン）
<button class="c-badge c-badge--popover" popovertarget="...">
--------------------------------------------------------- */
.c-badge[popovertarget] {
	position: relative;
	padding-right: 2em;

	/* 常時表示される “?” マーク */
	&::after {
		content: '?';
		display: inline-block;
		text-align: center;
		position: absolute;
		bottom: $spacing-2;
		width: 1.2rem;
		height: 1.2rem;
		line-height: 1.4;
		margin-left: .25em;

		background-color: $color-text;
		border-radius: $border-radius-full;
		font-family: $font-family-en;
		font-size: .9em;
		color: $color-white;
	}

	&.c-badge--popover:has(+ .c-popbox:popover-open) {
		background-position: right center;
		background-size: 200% auto;
		@include g.apply-ripple($color-primary, 10px, 1.5s, 1);
	}
}
